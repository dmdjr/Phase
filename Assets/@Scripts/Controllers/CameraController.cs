using System.Collections;
using System.Collections.Generic;
using Unity.VisualScripting;
using UnityEngine;

public class CameraController : MonoBehaviour
{
    //=================?? ????? Stage5, 10, 15???? ??? ?????? ???? ?????? ???? ????=========================
    [Header("????? ???????")]
    public Transform trans_Player;


    public float transitionCooldown = 0.5f; // ??? ???
    private bool isTransitioning = false; // ???? ??? ?????? ?????? ???? ????(??? ???)

    // ???? ????? ??? ?????????? ??????? ???? ?????
    public List<Transform> cameraStages;

    // ???? ?????????? ?? ?????? ?????? ???? (0???? ????)
    private int currentStageIndex = 0;

    public void Init()
    {
        // currentStageIndex = GameManager.Instance.currentStageNum - 1;
        // Transform nextStage = cameraStages[currentStageIndex];
        // transform.position = new Vector3(nextStage.position.x, nextStage.position.y, transform.position.z);
        currentStageIndex = GameManager.Instance.currentStageNum - 2;
        MoveToNextStage();
        Debug.Log("camera: " + currentStageIndex);
    }

    // ???? ?????????? ???? ??????? ???
    public void MoveToNextStage()
    {
        if (isTransitioning)
        {
            return;
        }
        isTransitioning = true;
        currentStageIndex++;

        // ???? ?????? ?????????? ??????? ???, ???? ?????? ???? ?? ??? ???? X
        if (currentStageIndex >= cameraStages.Count)
        {
            Debug.Log("?????? ??????????");
            // ??????? ????? ?????? ?????? ????? ?????? ??????? ????
            currentStageIndex = cameraStages.Count - 1;
            StartCoroutine(TransitionCooldown());
            return;
        }

        // ????????? ???? ?????????? ???(Transform)?? ??????
        Transform nextStage = cameraStages[currentStageIndex];

        // ??? ????? ???? ???
        // ?????? z?? ????? -1 ???????? x, y ????? ?????
        transform.position = new Vector3(nextStage.position.x, nextStage.position.y, transform.position.z);

        MoveCameraPosZ();


        StartCoroutine(TransitionCooldown());
    }

    void MoveCameraPosZ()
    {
        // 5????????????? ????? ?? ?????? ???? ???
        if (currentStageIndex == 4)
        {
            transform.position = new Vector3(transform.position.x, transform.position.y, 0f);
            trans_Player.position = new Vector3(trans_Player.position.x, trans_Player.position.y, 1f);
        }

        // 10????????????? ????? ?? ????
        if (currentStageIndex == 9)
        {
            transform.position = new Vector3(transform.position.x, transform.position.y, 0f);
            trans_Player.position = new Vector3(trans_Player.position.x, trans_Player.position.y, 1f);
        }

        // 15????????????? ????? ?? ????
        if (currentStageIndex == 14)
        {
            transform.position = new Vector3(transform.position.x, transform.position.y, 0f);
            trans_Player.position = new Vector3(trans_Player.position.x, trans_Player.position.y, 1f);

        }

    }
    public void RestoreCameraPosz()
    {
        transform.position = new Vector3(transform.position.x, transform.position.y, -1f);
        trans_Player.position = new Vector3(trans_Player.position.x, trans_Player.position.y, 0f);

    }
    private IEnumerator TransitionCooldown()
    {
        // transitionCooldown?? ?????? ?????? ????
        yield return new WaitForSeconds(transitionCooldown);

        // ???? ??? ????? ??????? ???? ????? ??????? ??
        isTransitioning = false;
    }
}
